## `lea`

Load effective address ‚Äî –Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –ø–∞–º—è—Ç–∏,
–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤ —Ä–µ–≥–∏—Å—Ç—Ä –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –∞–¥—Ä–µ—Å:

```x86asm
    lea 4(%esi, %edi, 8), %eax  // —Ç–µ–ø–µ—Ä—å eax = esi + 8*edi + 4

    lea (%eax, %eax, 8), %eax   // —É–º–Ω–æ–∂–∏–ª–∏ eax –Ω–∞ 9 ü§°
```

## –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ –∞–¥—Ä–µ—Å—É –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ

```x86asm
    jmp *%eax
```

–ù–∞–ø—Ä–∏–º–µ—Ä:
```x86asm
somelabel:
    ...

    ...
    mov $somelabel, %eax
    jmp *%eax
```

–ò–ª–∏ —Ç–∞–∫:
```x86asm
func1:
    ...
func2:
    ...

    .section .rodata
functable:
    .int func1
    .int func2

    .text
    ...
    mov functable + 4, %eax
    jmp *%eax
```

## –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ

![](unaligned-read.png)

–ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, *–ª—É—á—à–µ*, —á—Ç–æ–±—ã –º–Ω–æ–≥–æ–±–∞–π—Ç–æ–≤—ã–µ
–æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø–∞–º—è—Ç–∏ –±—ã–ª–∏ *–≤—ã—Ä–æ–≤–Ω–µ–Ω—ã* (aligned).

```x86asm
    // –Ω–∞—á–∞–ª–æ —Å–µ–∫—Ü–∏–∏
    .byte 1
    .int 1    // —ç—Ç–∏ 4 –±–∞–π—Ç–∞ –ª–µ–∂–∞—Ç –ø–æ –∞–¥—Ä–µ—Å—É, –Ω–µ –∫—Ä–∞—Ç–Ω–æ–º—É 4

    .balign 4 // byte align: –∑–¥–µ—Å—å –¥–æ–±–∞–≤–∏—Ç 3 –±–∞–π—Ç–∞ –Ω—É–ª–µ–π
    .int 1    // —ç—Ç–∏ 4 –±–∞–π—Ç–∞ –ª–µ–∂–∞—Ç –ø–æ –∞–¥—Ä–µ—Å—É, –∫—Ä–∞—Ç–Ω–æ–º—É 4

    .balign 2 // –Ω–µ –¥–æ–±–∞–≤–∏—Ç –Ω–∏—á–µ–≥–æ
    .short 1
```



## –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã

–ú—ã —Ö–æ—Ç–∏–º –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–¥ ‚Äî –≤—ã–∑—ã–≤–∞—Ç—å
–æ–¥–Ω—É –∏ —Ç—É –∂–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏–∑ —Ä–∞–∑–Ω—ã—Ö
—Ç–æ—á–µ–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

```x86asm
double_eax:
    sal $1, %eax
    jmp ...  // –∫—É–¥–∞?
    

    ...
    jmp double_eax
    // —Ö–æ—Ç–∏–º –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–¥–µ—Å—å

    ...
    jmp double_eax
    // –∏–ª–∏ –∑–¥–µ—Å—å
```

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ä–µ—à–∞—é—Ç —ç—Ç–æ —Å –ø–æ–º–æ—â—å—é
—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –¥–ª—è –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞.
–ï—Å–ª–∏ –±—ã —Ç–∞–∫–æ–π –±—ã–ª –≤ x86, –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã –º–æ–≥–ª–∏ –±—ã
–≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:
```x86asm
double_eax:
    sal $1, %eax
    jmp *%return_address
    

    ...
    mov $1f, %return_address
    jmp double_eax
1:

    ...
    mov $1f, %return_address
    jmp double_eax
1:
```

–ù–æ –≤ x86 –ø—Ä–∏–Ω—è—Ç–æ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–ª–∞—Å—Ç—å –Ω–∞ —Å—Ç–µ–∫:
```x86asm
double_eax:
    sal $1, %eax
    pop %edx        // –¥–æ—Å—Ç–∞—ë–º –∏–∑ —Å—Ç–µ–∫–∞ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
    jmp *%edx       // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ –Ω–µ–º—É
    

    ...
    push $1f        // –∫–ª–∞–¥—ë–º –≤ —Å—Ç–µ–∫ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
                    // (–∞–¥—Ä–µ—Å —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ—Å–ª–µ jmp)
    jmp double_eax  // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–∞—á–∞–ª–æ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã
1:

    ...
    push $1f
    jmp double_eax
1:
```

–î–ª—è —ç—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–≤—Ö–æ–¥ –≤ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—É –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∏–∑ –Ω–µ—ë)
–µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ `call` –∏ `ret`:
```x86asm
double_eax:
    sal $1, %eax
    ret             // –¥–æ—Å—Ç–∞—ë–º –∏–∑ —Å—Ç–µ–∫–∞ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
                    // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ –Ω–µ–º—É
    

    ...
    call double_eax // –∫–ª–∞–¥—ë–º –≤ —Å—Ç–µ–∫ –∞–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞
                    // (–∞–¥—Ä–µ—Å —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ—Å–ª–µ call)
                    // –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–∞—á–∞–ª–æ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã

    ...
    call double_eax
```

–í –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–µ –≤–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –±–∞–ª–∞–Ω—Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
`push` –∏ `pop`, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–º–∞—Ö–Ω—É—Ç—å—Å—è –º–∏–º–æ –∞–¥—Ä–µ—Å–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞.

## –°–æ–≥–ª–∞—à–µ–Ω–∏—è –æ –≤—ã–∑–æ–≤–∞—Ö

–ß—Ç–æ–±—ã —Ä–∞–∑–Ω—ã–µ –ª—é–¥–∏ (–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—ã) –º–æ–≥–ª–∏ —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å
–ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã, –∏–º –Ω—É–∂–Ω–æ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è, –∫–∞–∫ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å
–≤ –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–∞–∫ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∫–∞–∫–∏–µ
—Ä–µ–≥–∏—Å—Ç—Ä—ã –ø–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –±—É–¥–µ—Ç –ø–æ—Ä—Ç–∏—Ç—å. –¢–∞–∫–∏–µ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏
–Ω–∞–∑—ã–≤–∞—é—Ç—Å—è *—Å–æ–≥–ª–∞—à–µ–Ω–∏—è–º–∏ –æ –≤—ã–∑–æ–≤–∞—Ö* (calling conventions).

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ –Ω–∞—à–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ (Linux/x86)
–Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è [cdecl](https://en.wikipedia.org/wiki/X86_calling_conventions#cdecl):
* –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Å—Ç–µ–∫–µ, –ø—Ä–∏—á—ë–º –ª–µ–∂–∞—Ç –≤ –ø–∞–º—è—Ç–∏
  ¬´–ø–æ –ø–æ—Ä—è–¥–∫—É¬ª (–∞–¥—Ä–µ—Å —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –Ω–æ–º–µ—Ä–æ–º –∞—Ä–≥—É–º–µ–Ω—Ç–∞);
* –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–¥–∞–ª—è–µ—Ç –∏–∑ —Å—Ç–µ–∫–∞ —Ç–æ—Ç, –∫—Ç–æ –∏—Ö —Ç—É–¥–∞ –ø–æ–ª–æ–∂–∏–ª
  (—Ç–æ –µ—Å—Ç—å –≤—ã–∑—ã–≤–∞—é—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è);
* –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ eax
  (–∞ 64-–±–∏—Ç–Ω–æ–µ ‚Äî –≤ –ø–∞—Ä–µ `eax:edx`);
* caller-saved —Ä–µ–≥–∏—Å—Ç—Ä—ã: eax, ecx –∏ edx;
* callee-saved —Ä–µ–≥–∏—Å—Ç—Ä—ã: –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ.

–í–æ–æ—Ä—É–∂—ë–Ω–Ω—ã–µ —ç—Ç–∏–º –∑–Ω–∞–Ω–∏–µ–º, –º—ã —Ç–µ–ø–µ—Ä—å –º–æ–∂–µ–º –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏
–Ω–∞ –°–∏ –∏ –±—ã—Ç—å –∏–º–∏ –≤—ã–∑–≤–∞–Ω—ã:

```x86asm
    // int foobar(int a, int b)

    pushl b
    pushl a
    call foobar
    add $8, %esp

    // –≤–æ–∑–≤—Ä–∞—â—ë–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ª–µ–∂–∏—Ç –≤ %eax
```

```x86asm
    // –≤–æ–∑–º–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ foobar
    .global foobar
foobar:
    // —Å–µ–π—á–∞—Å —Å—Ç–µ–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫: ra  a  b
    mov 4(%esp), %eax
    add 8(%esp), %eax
    ret
```



## –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–ü–æ–¥ –Ω–∏—Ö –º—ã –≤—ã–¥–µ–ª—è–µ–º –º–µ—Å—Ç–æ –Ω–∞ —Å—Ç–µ–∫–µ:
```x86asm
baz:
    sub $8, %esp   // –≤—ã–¥–µ–ª–∏–ª–∏ —Å–µ–±–µ 8 –±–∞–π—Ç, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ —á—Ç–æ
    push $0        // –≤—ã–¥–µ–ª–∏–ª–∏ —Å–µ–±–µ 4 –±–∞–π—Ç–∞, –≤ –∫–æ—Ç–æ—Ä—ã—Ö 0
    // —Å–µ–π—á–∞—Å —Å—Ç–µ–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫: 0  ?  ?  ra  arg1  arg2...
```

–ß—Ç–æ–±—ã –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ —Ñ—É–Ω–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ esp, –ø—Ä–∏–¥—ë—Ç—Å—è
–ø–æ–º–Ω–∏—Ç—å, –Ω–∞ —Å–∫–æ–ª—å–∫–æ –º—ã —ç—Ç–æ—Ç esp —Å–º–µ—Å—Ç–∏–ª–∏:
```x86asm
    mov 16(%esp), %eax  // –¥–æ—Å—Ç–∞–ª–∏ –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç
```

## –°—Ç–µ–∫–æ–≤—ã–π –∫–∞–¥—Ä

–ü—Ä–∏–Ω—è—Ç–æ –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Ñ—É–Ω–∫—Ü–∏—é —Å–æ—Ö—Ä–∞–Ω—è—Ç—å esp –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ
ebp (base pointer), –∞ —Å–∞–º ebp —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Å—Ç–µ–∫–µ:
```x86asm
quux:
    push %ebp
    mov %esp, %ebp

    /*
    stack layout:  oldebp  ra  arg1  arg2...
                   ‚Üë ebp
    
    arg1: 8(%ebp)
    arg2: 12(%ebp)...

    local var 1: -4(%ebp)
    local var 2: -8(%ebp)...
    */

    ...

    mov %ebp, %esp
    pop %ebp
    ret
```
–°—Ç–µ–∫–æ–≤—ã–π –∫–∞–¥—Ä (stack frame):
```
    ‚îÇ   ...         ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ  saved ebp    ‚îÇ ‚óÑ‚îÄ‚îê
    ‚îÇ               ‚îÇ   ‚îÇ
    ‚îÇ               ‚îÇ   ‚îÇ
    ‚îÇ               ‚îÇ   ‚îÇ
    ‚îÇ  arg2         ‚îÇ   ‚îÇ
    ‚îÇ  arg1         ‚îÇ   ‚îÇ
    ‚îÇ  return addr  ‚îÇ   ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îÇ
ebp‚Üí‚îÇ  saved ebp    ‚îÇ ‚îÄ‚îÄ‚îò
    ‚îÇ  local1       ‚îÇ
esp‚Üí‚îÇ  local2       ‚îÇ
    ‚îÇ               ‚îÇ
```

## –¢–µ–∫—Å—Ç (–Ω–µ —Ç–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π `.text`, –∞ –Ω–∞—Å—Ç–æ—è—â–∏–π)

–ö–æ–¥–∏—Ä–æ–≤–∫–∞ [ASCII](https://en.wikipedia.org/wiki/ASCII#Character_set).
```x86asm
greeting:
    .byte 'H'  // —Ç–æ –∂–µ, —á—Ç–æ .byte 0x48
    .byte 'i'  // —Ç–æ –∂–µ, —á—Ç–æ .byte 0x69
    .byte ' '
    .ascii "guy"
    .asciz "s"  // —Ç–æ –∂–µ, —á—Ç–æ .ascii "s\0"

    .asciz "Hi guys"  // –µ—â—ë —Ä–∞–∑ —Ç–∞ –∂–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–π—Ç
```
